// --- datasource ---
datasource db {
    provider = "sqlite"
    url      = "file:../db/database.sqlite"
}

// --- generator ---
generator client {
    provider = "prisma-client-js"
}

enum Role {
    ADMIN
    CLIENT
    SUPPORT
}

enum TicketPriority {
    LOW
    MEDIUM
    HIGH
}

enum TicketStatus {
    OPEN
    IN_PROGRESS
    CLOSED
}

model User {
    id         Int      @id @default(autoincrement())
    name       String
    username   String   @unique
    password   String
    department String
    role       Role     @default(CLIENT)
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    ticketsCreated  Ticket[] @relation("CreatedTickets")
    ticketsAssigned Ticket[] @relation("AssignedTickets")
}

model Ticket {
    id          Int            @id @default(autoincrement())
    title       String
    status      TicketStatus   @default(OPEN)
    priority    TicketPriority
    category    String
    created_at  DateTime       @default(now())
    updated_at  DateTime       @updatedAt
    resolved_at DateTime?

    // Relação com usuário pelo username
    created_by_username String
    created_by          User   @relation("CreatedTickets", fields: [created_by_username], references: [username])

    assigned_to_username String?
    assigned_to          User?   @relation("AssignedTickets", fields: [assigned_to_username], references: [username])
}